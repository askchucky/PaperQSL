generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                     String    @id @default(cuid())
  clerkId                String    @unique
  email                  String
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  qrzPassword            String?
  qrzUsername            String?
  qrzSessionKey          String?
  qrzSessionKeyUpdatedAt DateTime?
  exports                Export[]
  qsos                   QSO[]
  stations               Station[]

  @@index([clerkId])
}

model QSO {
  id         String   @id @default(cuid())
  userId     String
  callsign   String
  date       DateTime
  time       String?
  band       String?
  mode       String?
  freq       String?
  rstSent    String?
  rstRcvd    String?
  qth        String?
  comment    String?
  adifData   Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  myPotaRef  String?
  sourceFile String?
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, callsign])
  @@index([userId, date])
}

model Station {
  id                     String    @id @default(cuid())
  userId                 String
  callsign               String
  qsoCount               Int       @default(0)
  eligibility            String    @default("Unknown")
  eligibilityOverride    Boolean   @default(false)
  addressLine1           String?
  addressLine2           String?
  city                   String?
  state                  String?
  postalCode             String?
  country                String?
  addressSource          String?
  lastVerifiedAt         DateTime?
  sentAt                 DateTime?
  sentMethod             String?
  receivedAt             DateTime?
  notes                  String?
  status                 String?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  qslCardImage           String?
  qslManager             String?
  qslCardBackUploadedAt  DateTime?
  qslCardBackUrl         String?
  qslCardFrontUploadedAt DateTime?
  qslCardFrontUrl        String?
  qrzFirstName           String?
  qrzLastName            String?
  qrzNameRaw             String?
  lastExportedAt         DateTime?
  lastExportedLabel      String?
  exportCount            Int       @default(0)
  user                   User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, callsign])
  @@index([userId, eligibility])
  @@index([userId, status])
}

model Export {
  id          String   @id @default(cuid())
  userId      String
  type        String
  filename    String
  blobUrl     String
  filters     Json?
  recordCount Int      @default(0)
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
}

model PotaList {
  reference    String   @id @db.Char(10)
  park_name    String?
  latitude     Decimal? @db.Decimal(8, 6)
  longitude    Decimal? @db.Decimal(9, 6)
  grid         String?  @db.Char(6)
  locationdesc String?

  @@map("potalist")
}
